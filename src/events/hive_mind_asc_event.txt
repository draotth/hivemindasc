namespace = hive_mind_asc

# Collective Ascension
country_event = {
	id = hive_mind_asc.1
	title = "hive_mind_asc.1.name"
	desc = "hive_mind_asc.1.desc"
	picture = GFX_evt_genetic_modification
	show_sound = event_evolution_mastery

	fire_only_once = yes
	mean_time_to_happen = { months = 3 }
	
	trigger = {
		NOT = { has_ethic = ethic_gestalt_consciousness }
		NOT = { has_special_project = HIVE_MIND_ASCENSION_PROJECT }
		has_technology = "tech_genetic_resequencing"
	}
	
	option = {
		name = "hive_mind_asc.1.a"
		capital_scope = {
			enable_special_project = {
				name = HIVE_MIND_ASCENSION_PROJECT
				location = this
				owner = root
			}
		}
	}
}

# Hive Mind Enabled
country_event = {
	id = hive_mind_asc.2
	title = "hive_mind_asc.2.name"
	desc = "hive_mind_asc.2.desc"
	picture = GFX_evt_genetic_modification
	show_sound = event_evolution_mastery
	
	is_triggered_only = yes
	
	option = {
		
		ai_chance = {
			factor = 95
		}
		name = "hive_mind_asc.2.a"
		custom_tooltip = "hive_mind_asc.2.a.tooltip"

		hidden_effect = {
			
			change_government = {
				authority = auth_hive_mind
				civics = random
			}
		}
	}

	option = {
		ai_chance = {
			factor = 5
		}

		name = "hive_mind_asc.2.b"
		custom_tooltip = "hive_mind_asc.2.b.tooltip"

		hidden_effect = {

			if = {
				limit = { has_technology = tech_galactic_administration }

				change_government = {
					authority = auth_hive_mind

					civics = {
						civic = civic_hive_devouring_swarm
						civic = random
						civic = random
					}
				}
			}

			if = {
				limit = {
					not = {
						has_technology = tech_galactic_administration
					}
				}
				
				change_government = {
					authority = auth_hive_mind

					civics = {
						civic = civic_hive_devouring_swarm
						civic = random
					}
				}
			}
		}
	}

	immediate = {
		set_country_flag = hive_mind	
		shift_ethic = ethic_gestalt_consciousness
		
		#values for hive mind
		# set_country_flag = hive_mind
		
		#values for devouring swarm
		# set_country_flag =  devouring_swarm
		
		
		#for both
		#advisor_voice_type="l_hivemind"
		
		#TODO: Here's the mapping for non-hive to hive civics. Possibly out of date post 2.2
		# Civics from -> to
		# 1 Meritocracy -> Pooled knowledge (+1 leader pool, +1 leader level)
		# 2 Cutthroat Politics -> Subsumed Will (+1 influence)
		# 3 Efficient Bureaucracy -> Divided Attention (+2 core sectors)
		# 4 Citizen service -> Subspace Ephapse (+15% naval capacity)
		# 5 Technocracy -> Natural Neural Network (+1 research alt)
		# 6 Environmentalist -> Ascetic (-20% consumer goods cost)
		# 7 Beacon of liberty -> One Mind (+15% unity)
		# 8 Warrior culture -> Strength of legions (+20% army damage -20% army upkeep)
		
		
		random_owned_pop = {
			limit = { is_same_species = root }
			create_hive_mind_species_mod = yes
		}
		change_dominant_species = {
			species = last_created
		}
		
		set_name = "[This.GetSpeciesName] Collective"  #Todo: Localize. or better use empire name format and random list better
		
		#note to self: see 00_empire_names.txt
		
		while = {
			limit = {
				any_owned_pop = {
					is_sapient = yes
					species = {
						NOR = {
							has_trait = trait_hive_mind 
		  					has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = leader_trait_curator
						}
					}
				}
			}
			random_owned_pop = {
				limit = {
					is_sapient = yes
					species = {
						NOR = {
							has_trait = trait_hive_mind 
		  					has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = leader_trait_curator
						}
					}
				}
				create_hive_mind_species_mod = yes
				
				set_citizenship_type = {
					country = owner
					type = citizenship_full
					cooldown = no
				}
			}
		}
		
		while = {
			limit = {
				any_owned_leader = {
					species = {
						NOR = {
							has_trait = trait_hive_mind 
		  					has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = leader_trait_curator
						}
					}
				}
			}
			random_owned_leader = {
				limit = {
					species = {
						NOR = {
							has_trait = trait_hive_mind 
		  					has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = leader_trait_curator
						}
					}
				}
				create_hive_mind_species_mod = yes
			}
		}
		
		while = {
			limit = {
				any_pool_leader = {
					species = {
						NOR = {
							has_trait = trait_hive_mind 
		  					has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = leader_trait_curator
						}
					}
				}
			}
			random_pool_leader = {
				limit = {
					species = {
						NOR = {
							has_trait = trait_hive_mind 
		  					has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = leader_trait_curator
						}
					}
				}
				create_hive_mind_species_mod = yes
			}
		}
		
		while = {
			limit = {
				any_owned_army = {
					exists = species
					species = {
						NOR = {
							has_trait = trait_hive_mind 
		  					has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = leader_trait_curator
						}
					}
				}
			}
			random_owned_army = {
				limit = {
					exists = species
					species = {
						NOR = {
							has_trait = trait_hive_mind 
		  					has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = leader_trait_curator
						}
					}
				}
				create_hive_mind_species_mod = yes
			}
		}

		every_owned_ship = {
			limit = {
				is_ship_class = shipclass_colonizer
				species = {
						NOR = {
							has_trait = trait_hive_mind 
		  					has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_trait = leader_trait_curator
						}
				}
			}
			create_hive_mind_species_mod = yes
		}
		
		
		every_owned_leader = {
			limit = {
				species = { has_trait = trait_hive_mind }
				NOT = {
					has_trait = leader_trait_ruler_hive_mind
				}
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_ruler_hive_mind
			}
		}
		
		every_pool_leader = {
			limit = {
				species = { has_trait = trait_hive_mind }
				NOT = {
					has_trait = leader_trait_ruler_hive_mind
				}
			}
			if = {
				limit = { leader_class = ruler }
				add_trait = leader_trait_ruler_hive_mind
			}
		}

		observer_event = { id = hive_mind_asc.4 }
		
		every_country = {
			limit = {
				is_ai = no
				NOT = { is_same_value = root }
				has_communications = root
			}
			country_event = { id = hive_mind_asc.3 days = 5 }
		}

		
	}
}

# Notification for Other Nations
country_event = {
	id = hive_mind_asc.3
	
	title = "hive_mind_asc.3.name"
	desc = {
		text = hive_mind_asc.3.1.desc
		trigger = {
			NOR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
	}
	desc = {
		text = hive_mind_asc.3.2.desc
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
	}
	picture = GFX_evt_genetic_modification
	#show_sound = event_the_flesh_is_weak
	
	is_triggered_only = yes
	
	option = {
		name = "DISCONCERTING"
		trigger = {
			NOR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
	}
	option = {
		name = "hive_mind_asc.3.a"
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
	}
}

# Becomes Hive Mind
observer_event = {
	id = hive_mind_asc.4
	title = "hive_mind_asc.3.name"
	desc = "hive_mind_asc.3.1.desc"
	picture = GFX_evt_genetic_modification

	is_triggered_only = yes

	option = {
		name = OK
	}
}
